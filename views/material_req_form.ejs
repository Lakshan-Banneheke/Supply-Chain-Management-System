<%- include('_header',{title:"Dashboard"}) %>
<body class="hold-transition sidebar-mini">
    <div class="wrapper">
      <!-- Navbar -->
      <nav class="main-header navbar navbar-expand navbar-white navbar-light">
        <!-- Left navbar links -->
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
          </li>
          <li class="nav-item d-none d-sm-inline-block">
            <a class="nav-link">Welcome</a>
          </li>
        </ul>
    
        <!-- Right navbar links -->
        <ul class="navbar-nav ml-auto">
          <!-- Navbar Search -->
          <!--<li class="nav-item">
            <a class="nav-link" data-widget="navbar-search" href="#" role="button">
              <i class="fas fa-search"></i>
            </a>
            <div class="navbar-search-block">
              <form class="form-inline">
                <div class="input-group input-group-sm">
                  <input class="form-control form-control-navbar" type="search" placeholder="Search" aria-label="Search">
                  <div class="input-group-append">
                    <button class="btn btn-navbar" type="submit">
                      <i class="fas fa-search"></i>
                    </button>
                    <button class="btn btn-navbar" type="button" data-widget="navbar-search">
                      <i class="fas fa-times"></i>
                    </button>
                  </div>
                </div>
              </form>
            </div>
          </li>-->
    
          <!-- Messages Dropdown Menu -->
          <li class="nav-item dropdown">
            <a class="nav-link" data-toggle="dropdown" href="#">
              <i class="far fa-comments"></i>
              <span class="badge badge-danger navbar-badge">3</span>
            </a>
            <div class="dropdown-menu dropdown-menu-lg dropdown-menu-right">
              <a href="#" class="dropdown-item">
                <!-- Message Start -->
                <div class="media">
                  <img src="../../dist/img/user1-128x128.jpg" alt="User Avatar" class="img-size-50 mr-3 img-circle">
                  <div class="media-body">
                    <h3 class="dropdown-item-title">
                      Brad Diesel
                      <span class="float-right text-sm text-danger"><i class="fas fa-star"></i></span>
                    </h3>
                    <p class="text-sm">Call me whenever you can...</p>
                    <p class="text-sm text-muted"><i class="far fa-clock mr-1"></i> 4 Hours Ago</p>
                  </div>
                </div>
                <!-- Message End -->
              </a>
              <div class="dropdown-divider"></div>
              <a href="#" class="dropdown-item">
                <!-- Message Start -->
                <div class="media">
                  <img src="../../dist/img/user8-128x128.jpg" alt="User Avatar" class="img-size-50 img-circle mr-3">
                  <div class="media-body">
                    <h3 class="dropdown-item-title">
                      John Pierce
                      <span class="float-right text-sm text-muted"><i class="fas fa-star"></i></span>
                    </h3>
                    <p class="text-sm">I got your message bro</p>
                    <p class="text-sm text-muted"><i class="far fa-clock mr-1"></i> 4 Hours Ago</p>
                  </div>
                </div>
                <!-- Message End -->
              </a>
              <div class="dropdown-divider"></div>
              <a href="#" class="dropdown-item">
                <!-- Message Start -->
                <div class="media">
                  <img src="../../dist/img/user3-128x128.jpg" alt="User Avatar" class="img-size-50 img-circle mr-3">
                  <div class="media-body">
                    <h3 class="dropdown-item-title">
                      Nora Silvester
                      <span class="float-right text-sm text-warning"><i class="fas fa-star"></i></span>
                    </h3>
                    <p class="text-sm">The subject goes here</p>
                    <p class="text-sm text-muted"><i class="far fa-clock mr-1"></i> 4 Hours Ago</p>
                  </div>
                </div>
                <!-- Message End -->
              </a>
              <div class="dropdown-divider"></div>
              <a href="#" class="dropdown-item dropdown-footer">See All Messages</a>
            </div>
          </li>
         
          <li class="nav-item">
            <a class="nav-link" data-widget="fullscreen" href="#" role="button">
              <i class="fas fa-expand-arrows-alt"></i>
            </a>
          </li>
          
        </ul>
      </nav>
      <!-- /.navbar -->
 
          <%- include('_sidebar') %>
      
    
      <!-- Content Wrapper. Contains page content -->
      <div class="content-wrapper">
        <!-- Content Header (Page header) -->
        <section class="content-header">
            <div class="container-fluid">
                <div class="row mb-2">
                  <div class="col-sm-12">
                    <div class="card card-success">
                        <div class="card-body">
                            <div class="row">
                                
                                    <div class="container">
                                      <h3>Project Details</h3>
                                      <p>Project Name: <%=projectName%></p>
                                      <p>Project Section: <%=projectSection%></p>
                                      <p>Note/Reason: <%=note%></p>
                                      <p>Request Date: <%=date%></p>
                                    </div>
                                    <form method="GET" action="/supervisor/create-new-reqP">
                                        <input type="submit" value="Change Project" />
                                    </form>                                 
                                
                            </div>
                        </div>
                    </div>             
                  </div>
                </div>
              </div><!-- /.container-fluid -->
        </section>

        <section class="content-header">
            <div class="container-fluid">
                <form action="/supervisor/send-to-expeditor" method="POST">
                    <div class="form-group" margin = 10px>
                        <label for="newMaterial">Ask Expeditor for New Material</label>
                        <input type="text" class="form-control" id="newMaterial" placeholder="Write Material name" name = "msg" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Send to Expeditor</button>
                </form> 
            </div><!-- /.container-fluid -->
        </section>
    
        <section class="content">
            <div class="container-fluid">
    
               
                <form id ="myForm">
                    <div class="row" width =80%>
                            
                        <div class="form-group" margin = 10px>
                            <label for="materialSelect">Select a material</label>
                            <select class="form-control" id="materialSelect" name= "materialSelect" required>
                            <option value="">Select one</option>
                            <% for (var i = 0; i < materials.length; i++) { %>
                                <option value=<%=materials[i].material_name%>>
                                <%= materials[i].material_name %> - unit by (<%= materials[i].unit %>)
                                </option>
                                <% } %>
                            </select>
                        </div>
                        
                        <div class="form-group" margin = 10px>
                            <label for="quantity">Quantity:</label>
                            <input name ="quantity" type="number" class="form-control" id="quantity" min=1 oninput="validity.valid||(value='');" required >
                        </div>
        
                        <button type="button" class="btn btn-primary" id="addMaterial">Add Mat</button>
                    </div>    
                </form>
  
       
                <div>
                    <table class="table" id ="example-table">
                        <thead>
                        <tr>
                            <th scope="col">Material Name</th>
                            <th scope="col">Quantity</th>
                        </tr>
                        </thead>
                        <tbody>
                        
                        </tbody>
                    </table>
                    <br>
                    
                </div>
          
       
                <button type="button" class="btn btn-primary" id="submitBtn" >Send Request</button>
       
  
                <button type="button" class="btn btn-primary" value="cancel" id="cancel" onclick="window.location.reload()">Cancel</button>
               
                
              
            </div><!-- /.container-fluid -->
        </section>
    
      </div>
      <!-- /.content-wrapper -->
      <footer class="main-footer">
        <div class="float-right d-none d-sm-block">
          <b>All rights reserved</b>
        </div>
        <strong>Copyright &copy; 2021 <a>SE-Group 12</a>.</strong>
      </footer>
    
      <!-- Control Sidebar -->
      <aside class="control-sidebar control-sidebar-dark">
        <!-- Control sidebar content goes here -->
      </aside>
      <!-- /.control-sidebar -->
    </div>
    <!-- ./wrapper -->
    </body>

    <script>
        let  Addbtn = document.getElementById("addMaterial");
        let  SubmitBtn = document.getElementById("submitBtn");
        let  table = document.getElementById("example-table");
        let  newMatName = document.getElementById("materialSelect");
        let  newMatQt = document.getElementById("quantity");
      
        Addbtn.addEventListener('click',()=>{
          
          var materialName = newMatName.value;
          var materialQuantity = newMatQt.value;
      
          if(materialName == "" || materialQuantity == 0){
            alert("You want to select a material and quantity");
          }
          else{
            let temp = `
            <tr>
              <td>${materialName}</td>
              <td>${materialQuantity}</td>
              <td><input type="button" value="Delete" onclick="deleteRow(this)"/></td>    
            </tr> `;
          
          // const data = {materialName, materialQuantity}
          // allMaterial.push(data)
          table.innerHTML += temp
          document.getElementById("myForm").reset();
      
          }
      
        });
      
        function deleteRow(btn) {
        var row = btn.parentNode.parentNode;
        row.parentNode.removeChild(row);
        }
      
        SubmitBtn.addEventListener('click',()=>{
          
          var table1 = $('#example-table').tableToJSON();
       
          if(table1.length == 0 ){
            console.log("Select Materials")
            alert("You want to select a material and quantity");
          }
          else{
            
            $.ajax({
                          type: "POST",
                          url: '/supervisor/collect-form-data',
                          data: {
                            "len": table1.length,
                            "table": table1
                          },
                          contentType: "application/x-www-form-urlencoded; charset=UTF-8",        
                          success: function (response) {
                              console.log(response);
                              // $('#create_account_form_submit').children('.reg-success').remove();
                              if (response.result == 'redirect') {
                                  //redirecting
                                  window.location.replace(response.url);
                                }
                          },
                          error: function (res) {
                          }
                      });
          }
        }
       );
      
       
      </script> 
      
      

    <%- include('_footer') %>